# 飞牛NAS (FnOS) 部署 OpenClaw 标准操作手册 (SOP)

**版本**: 1.0
**环境**: 飞牛NAS (Linux), macOS (客户端)
**部署方式**: 原生安装 (非 Docker)

## 1. 准备工作

在开始之前，请确保拥有以下信息和权限：
*   **飞牛NAS**: 已开启 SSH 访问权限。
*   **Zhipu AI (Z.ai)**: 有效的 API Key。
*   **飞书 (Feishu)**: 相关的 Webhook 地址或应用配置信息（App ID/Secret）。
*   **macOS 终端**: 用于连接 NAS 和建立隧道。

## 2. 系统安装 (服务端)

通过 SSH 登录到飞牛NAS的终端，执行官方推荐的安装脚本。

**步骤：**

1.  登录 NAS 终端。
2.  执行一键安装脚本：
    ```bash
    curl -fsSL https://openclaw.ai/install.sh | bash
    ```
3.  **初始化配置**：
    *   安装脚本执行过程中或完成后，系统会引导进行配置。
    *   **AI 配置**: 粘贴你的 `Z.ai key`。
    *   **消息平台配置**: 根据提示输入飞书 (Feishu) 的相关配置参数。

4.  **启动服务**：
    *   安装完成后，OpenClaw 服务会自动启动（或根据提示手动启动）。
    *   默认服务监听端口为 `18789`（仅监听 localhost 或内网 IP）。

## 3. 远程访问设置 (客户端 - macOS)

由于服务运行在 NAS 上，且可能是为了安全或网络限制，我们通过 SSH 隧道将 NAS 的服务端口映射到 macOS 本地。

**步骤：**

1.  打开 macOS 的终端 (Terminal)。
2.  运行以下 SSH 端口转发命令（请根据实际用户名修改）：
    ```bash
    # 语法: ssh -N -L 本地端口:目标IP:目标端口 用户名@NAS_IP
    ssh -N -L 18789:127.0.0.1:18789 huangfeng@192.168.101.101
    ```
    *   **参数解释**:
        *   `-N`: 不执行远程命令，仅用于转发端口。
        *   `-L 18789:127.0.0.1:18789`: 将 macOS 的 `18789` 端口转发到 NAS 的 `127.0.0.1:18789`。
        *   `huangfeng@192.168.101.101`: NAS 的 SSH 登录信息。
3.  输入 SSH 密码（如果未配置密钥登录）。
4.  *注意：该终端窗口会保持挂起状态，请勿关闭。如果需要后台运行，可添加 `-f` 参数。*

## 4. 验证与使用

**步骤：**

1.  在 macOS 上打开浏览器（如 Chrome 或 Safari）。
2.  访问地址：
    ```
    http://localhost:18789
    ```
3.  如果配置成功，你应该能看到 OpenClaw 的管理界面或交互页面。

## 5. 常见问题排查

*   **SSH 连接被拒绝**：检查飞牛NAS 是否开启了 SSH 功能，以及防火墙是否放行了 SSH 端口（默认 22）。
*   **无法访问 localhost:18789**：
    *   检查 SSH 隧道命令是否报错。
    *   在 NAS 上运行 `netstat -tulpn | grep 18789` 确认 OpenClaw 是否正常运行且监听了端口。
*   **服务未启动**：检查安装日志，确认 Z.ai Key 和飞书配置是否正确。
